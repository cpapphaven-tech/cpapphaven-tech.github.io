<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Early Tracking Script -->
    <script>
        (function () {
            const anonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJqcGdvdmZ6b25sbWpycnVhc3BwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAyNjA0MDQsImV4cCI6MjA4NTgzNjQwNH0.fwBaiOgXtnQVgq0IOdPmOskQHDqgOWWqr0mm3PSu57I";
            const endpoint = "https://bjpgovfzonlmjrruaspp.supabase.co/functions/v1/collect";

            const urlParams = new URLSearchParams(window.location.search);
            const placementId = urlParams.get('utm_content') || urlParams.get('placementid');

            const hitData = {
                timestamp: new Date().toISOString(),
                url: location.href,
                referrer: document.referrer,
                userAgent: navigator.userAgent,
                screen: { width: screen.width, height: screen.height },
                loadStage: "pre-init",
                placement_id: placementId
            };

            const sendHit = (stage) => {
                hitData.loadStage = stage;
                hitData.timestamp = new Date().toISOString();
                fetch(endpoint, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "apikey": anonKey,
                        "Authorization": "Bearer " + anonKey
                    },
                    body: JSON.stringify(hitData),
                    keepalive: true
                });
            };

            sendHit("pre-init");

            window.addEventListener("pagehide", function () {
                if (!window.FIREBASE_INITIALIZED) {
                    sendHit("early-exit");
                }
            });
        })();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Basketball 3D - PlayMixGames</title>

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Project Scripts -->
    <script src="../ads.js"></script>
    <script type="module" src="../analytics.js"></script>
    <script defer src="game.js"></script>

    <!-- Cookie Consent Script -->
    <script>
        (function () {
            const CONSENT_KEY = 'play-mix-games-cookie-consent';
            function getCookieConsent() {
                const stored = localStorage.getItem(CONSENT_KEY);
                return stored ? JSON.parse(stored) : null;
            }
            function showCookieBanner() {
                const consent = getCookieConsent();
                if (!consent) {
                    const banner = document.getElementById('cookie-consent');
                    if (banner) banner.classList.remove('hidden');
                }
            }
            function acceptCookies() {
                const consent = { accepted: true, timestamp: new Date().toISOString() };
                localStorage.setItem(CONSENT_KEY, JSON.stringify(consent));
                document.getElementById('cookie-consent')?.classList.add('hidden');
                window.cookieConsent = true;
                console.log('‚úÖ Cookie consent accepted');
            }
            function declineCookies() {
                const consent = { accepted: false, timestamp: new Date().toISOString() };
                localStorage.setItem(CONSENT_KEY, JSON.stringify(consent));
                document.getElementById('cookie-consent')?.classList.add('hidden');
                window.cookieConsent = false;
                console.log('‚ùå Cookie consent declined');
            }
            document.addEventListener('DOMContentLoaded', function () {
                document.getElementById('cookie-accept')?.addEventListener('click', acceptCookies);
                document.getElementById('cookie-decline')?.addEventListener('click', declineCookies);
                setTimeout(showCookieBanner, 500);
            });
            window.cookieConsent = getCookieConsent()?.accepted ?? null;
        })();
    </script>

    <!-- Styling -->
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#e65100">
    <link rel="apple-touch-icon" href="../icons/icon-192x192.png">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;900&display=swap" rel="stylesheet">

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            setTimeout(() => {
                if (window.DEV_MODE) {
                    return;
                }
                loadSocialBarAd();
            }, 100);
        });
    </script>
</head>

<body>
    <!-- Full Leaderboard -->
    <div id="full-leaderboard" class="overlay hidden">
        <div class="lb-header">
            <h2>üèÜ Basketball Champion üèÜ </h2>
            <p>Top 20 Worldwide</p>
        </div>
        <div class="lb-scroll-area">
            <ul id="full-lb-list"></ul>
        </div>
        <button onclick="closeFullLeaderboard()" class="close-btn">Close</button>
    </div>

    <!-- Side Leaderboard -->
    <div id="side-leaderboard" class="visible">
        <h3>üèÜ BasketBall Champion üèÜ</h3>
        <ul id="side-lb-list"></ul>
        <div id="view-full-lb">üèÜ Global Top 20</div>
    </div>



    <div id="tutorial-overlay" class="hidden">
        <div id="tutorial-dialog">

            <div id="tutorial-inner">

                <div id="tutorial-video-container">
                    <video id="tutorial-video" muted autoplay playsinline preload="auto">
                        <source src="../assets/basketball.mp4" type="video/mp4">
                    </video>
                </div>

                <div id="tutorial-text">
                    <h3>üéÆ How to Play</h3>
                    <p>üëá Pick up the ball to shoot</p>
                    <p>üéØ Aim for the hoop!</p>
                </div>


            </div>
        </div>
    </div>

    <div id="party-welcome" class="hidden">
        <div id="party-text">üéâ Welcome!</div>
        <canvas id="confetti-canvas"></canvas>
    </div>


    <div id="game-wrapper">
        <canvas id="game-canvas"></canvas>
        <!-- UI Overlay -->
        <div id="ui-container">
            <div id="score-container">
                <h1 id="score">0</h1>
            </div>

            <div id="goal-feedback" class="hidden">BASKET!</div>

            <!-- Challenge Message -->
            <div id="challenge-message" class="hidden">
                <div class="challenge-emoji">üèÄ</div>
                <div class="challenge-text">Can you strike the ball<br>in hoop at least 5 times?</div>
                <div class="challenge-subtext">Let's shoot! üéØ</div>
            </div>

            <div id="swipe-guide" class="visible">
                <div class="swipe-hand">üëÜ</div>
                <p>SWIPE UP TO SHOOT!</p>
            </div>

            <div id="main-menu" class="overlay hidden">
                <h2 id="title">BASKETBALL 3D</h2>
                <p id="prompt">üèÄ Swipe up to shoot for the hoop!</p>
                <button id="start-btn">PLAY BALL</button>
            </div>

            <div id="game-over" class="overlay hidden">
                <h2>GAME OVER!</h2>
                <p>Points: <span id="final-score">0</span></p>
                <p>Best: <span id="best-score">0</span></p>

                <div id="gameover-input-area">
                    <input id="player-name-gameover" placeholder="Enter Name for Leaderboard" maxlength="12">
                    <button id="submit-score-btn">Submit Score</button>
                </div>

                <button id="bonus-btn" class="hidden">üéÅ Watch Ad & Get +1 Life</button>
                <button id="restart-btn">Try Again</button>
                <button id="join-tg-btn" class="join-tg-btn">üèÜ Top 20 Leaderboard</button>

                <!-- Game Scroller Container -->
                <div id="game-over-scroller"></div>
            </div>
        </div>
    </div>

    <!-- COOKIE CONSENT BANNER -->
    <div id="cookie-consent" class="cookie-banner hidden">
        <div class="cookie-content">
            <div class="cookie-text">
                <span class="cookie-icon">üç™</span>
                <span>We use cookies & tracking for ads. <a href="../privacy.html" target="_blank"
                        style="color: #ff9800; text-decoration: underline;">Learn more</a></span>
            </div>
            <div class="cookie-buttons">
                <button id="cookie-accept" class="cookie-btn cookie-btn-accept">Accept</button>
                <button id="cookie-decline" class="cookie-btn cookie-btn-decline">Decline</button>
            </div>
        </div>
    </div>

    <!-- RIGHT SIDE ADSTERRA BANNER (Desktop Only) -->
    <div id="adsterra-banner"></div>

    <!-- SEMANTIC DESCRIPTION FOR SEO -->
    <section class="game-description" style="margin-top: 300px;">
        <h2 style="color: #fff; margin-bottom: 20px;">Master the Perfect Shot</h2>
        <p>Basketball 3D brings the excitement of the court to your browser. Use your timing and aim to sink as many
            baskets as you can. As your score increases, the challenge grows with moving targets and increased
            distances.</p>

        <h3 style="color: #fff; margin: 30px 0 15px;">How to Play</h3>
        <ul style="list-style-position: inside; margin-bottom: 30px;">
            <li><strong>Shoot:</strong> Swipe up or click and drag upward to throw the ball.</li>
            <li><strong>Arc:</strong> The speed and length of your swipe determine the power and arc of your shot.</li>
            <li><strong>Challenge:</strong> Rack up points and compete on the global leaderboard!</li>
        </ul>

        <div style="text-align: center; margin-top: 50px;">
            <a href="../index.html" style="color: #ff9800; text-decoration: none; font-weight: bold;">‚Üê Back to
                Portal</a>
        </div>
    </section>

    <footer>
        <div class="footer-links" style="text-align:center; padding: 40px;">
            <a href="../privacy.html" style="color: #666; text-decoration: none; margin: 0 10px;">Privacy</a>
            <a href="../terms.html" style="color: #666; text-decoration: none; margin: 0 10px;">Terms</a>
        </div>
    </footer>



    <!-- BOTTOM BANNER AD -->
    <div id="bottom-ad"></div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const container = document.getElementById("bottom-ad");
            function loadBanner() {
                if (typeof shouldLoadAds === "function" && !shouldLoadAds()) return;
                if (!container) return;
                container.innerHTML = '<div id="banner-slot"></div>';
                const slot = document.getElementById("banner-slot");
                window.atOptions = {
                    key: "de617c07128b585ef939154460e6858f",
                    format: "iframe",
                    height: 50,
                    width: 320,
                    params: {}
                };
                const s = document.createElement("script");
                s.src = "https://www.highperformanceformat.com/de617c07128b585ef939154460e6858f/invoke.js";
                slot.appendChild(s);
            }
            if (window.DEV_MODE) {
                return;
            }
            setTimeout(loadBanner, 100);
        });
    </script>

</body>

</html>