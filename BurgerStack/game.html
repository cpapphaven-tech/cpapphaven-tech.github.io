<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Early Tracking Script -->
    <script>
        (function () {
            const startTime = Date.now();
            const anonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJqcGdvdmZ6b25sbWpycnVhc3BwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAyNjA0MDQsImV4cCI6MjA4NTgzNjQwNH0.fwBaiOgXtnQVgq0IOdPmOskQHDqgOWWqr0mm3PSu57I";
            const endpoint = "https://bjpgovfzonlmjrruaspp.supabase.co/functions/v1/collect";

            const urlParams = new URLSearchParams(window.location.search);
            const placementId = urlParams.get('utm_content') || urlParams.get('placementid');

            const hitData = {
                timestamp: new Date(Date.now() + 19800000).toISOString().replace('Z', '+05:30'),
                url: location.href,
                referrer: document.referrer,
                userAgent: navigator.userAgent,
                screen: { width: screen.width, height: screen.height },
                loadStage: "pre-init",
                placement_id: placementId
            };

            const sendHit = (stage) => {
                hitData.loadStage = stage;
                hitData.timestamp = new Date(Date.now() + 19800000).toISOString().replace('Z', '+05:30');

                if (stage === "early-exit") {
                    hitData.duration_seconds = Math.round((Date.now() - startTime) / 1000);
                }

                fetch(endpoint, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "apikey": anonKey,
                        "Authorization": "Bearer " + anonKey
                    },
                    body: JSON.stringify(hitData),
                    keepalive: true
                });
            };

            sendHit("pre-init");

            window.addEventListener("pagehide", function () {
                if (!window.FIREBASE_INITIALIZED) {
                    sendHit("early-exit");
                }
            });
        })();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçî Burger Stack 3D - Stack the Ultimate Burger! | PlayMixGames</title>
    <meta name="description"
        content="Stack the ultimate burger! Tap to drop ingredients and build the tallest burger tower. Addictive 3D stacking game for all ages!">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="../loader.css">

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6129521314653726"
        crossorigin="anonymous"></script>

    <!-- Firebase Analytics -->
    <script type="module" src="../analytics.js"></script>

    <!-- Load Ads Script -->
    <script src="../ads.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            loadSocialBarAd();
            renderTopRightScroller();
        });
    </script>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>

<body>
    <!-- ===== PlayMixGames Universal Loader ===== -->
    <div id="pmg-loader">
        <div class="pmg-brand">PlayMixGames</div>
        <div class="pmg-spinner"></div>
        <div class="pmg-bar-track">
            <div class="pmg-bar-fill"></div>
        </div>
        <p class="pmg-tip">Loading...</p>
    </div>
    <!-- ========================================= -->
    <!-- Header -->
    <header>
        <a href="../index.html" class="back-btn">‚Üê PlayMixGames</a>
        <h1 class="game-title">üçî Burger Stack 3D</h1>
        <div class="score-display">
            <span id="score">0</span>
        </div>
    </header>

    <!-- RIGHT SIDE ADSTERRA BANNER (Desktop Only) -->
    <div id="adsterra-banner">
        <!-- Script will be injected here by game.js after 2s -->
    </div>

    <div id="game-wrapper">
        <!-- Game Container -->
        <div id="game-container">
            <!-- Instructions Panel (Left Side) -->
            <div id="instructions-panel">
                <div class="panel-content">
                    <h2 class="panel-title">üçî Burger Stack 3D</h2>
                    <h3 class="panel-subtitle">Build the Ultimate Burger!</h3>

                    <div class="instructions-section">
                        <h4>How to Play</h4>
                        <div class="instruction-item">
                            <span class="instruction-icon">üëÜ</span>
                            <div class="instruction-text">
                                <strong>Tap to Stack</strong><br>
                                <small>Click/tap to drop ingredients</small>
                            </div>
                        </div>
                        <div class="instruction-item">
                            <span class="instruction-icon">üéØ</span>
                            <div class="instruction-text">
                                <strong>Perfect Alignment</strong><br>
                                <small>Align perfectly for bonus points</small>
                            </div>
                        </div>
                        <div class="instruction-item">
                            <span class="instruction-icon">üìè</span>
                            <div class="instruction-text">
                                <strong>Stay Centered</strong><br>
                                <small>Overhang gets trimmed off</small>
                            </div>
                        </div>
                        <div class="instruction-item">
                            <span class="instruction-icon">üèÜ</span>
                            <div class="instruction-text">
                                <strong>Build High</strong><br>
                                <small>Stack as many as you can!</small>
                            </div>
                        </div>
                    </div>

                    <div class="tips-section">
                        <h4>Pro Tips</h4>
                        <p>‚Ä¢ Watch the ingredient movement</p>
                        <p>‚Ä¢ Time your taps perfectly</p>
                        <p>‚Ä¢ Perfect stacks = bonus points</p>
                        <p>‚Ä¢ Build the tallest burger!</p>
                    </div>

                    <div class="ingredients-section">
                        <h4>Ingredients</h4>
                        <div class="ingredient-list">
                            <span>üçû Bun</span>
                            <span>ü•© Patty</span>
                            <span>üßÄ Cheese</span>
                            <span>ü•¨ Lettuce</span>
                            <span>üçÖ Tomato</span>
                            <span>ü•ì Bacon</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Game Over Screen -->
            <div id="gameover-screen" class="overlay-screen hidden">
                <div class="screen-content">
                    <h1 class="title-main">Game Over!</h1>
                    <h2 class="title-sub">Your Burger Tower Fell!</h2>
                    <div class="final-stats">
                        <div class="stat-item">
                            <span class="stat-label">Height</span>
                            <span class="stat-value" id="final-height">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Score</span>
                            <span class="stat-value" id="final-score">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Perfect Stacks</span>
                            <span class="stat-value" id="final-perfects">0</span>
                        </div>
                    </div>
                    <button id="restart-btn" class="game-btn primary-btn">
                        üçî Stack Again
                    </button>
                    <button id="home-btn" class="game-btn secondary-btn">
                        üè† Home
                    </button>
                </div>
            </div>

            <!-- Game HUD -->
            <div id="game-hud" class="hidden">
                <div class="hud-top">
                    <div class="hud-item">
                        <span class="hud-label">Height</span>
                        <span class="hud-value" id="height">0</span>
                    </div>
                    <div class="hud-item">
                        <span class="hud-label">Perfect</span>
                        <span class="hud-value" id="perfect-count">0</span>
                    </div>
                    <div class="hud-item">
                        <span class="hud-label">Combo</span>
                        <span class="hud-value" id="combo">0</span>
                    </div>
                </div>
            </div>

            <!-- Perfect Stack Notification -->
            <div id="perfect-notification" class="hidden">
                <span class="perfect-text">PERFECT! üéØ</span>
                <span class="perfect-bonus">+50</span>
            </div>

            <!-- Canvas -->
            <canvas id="game-canvas"></canvas>

            <!-- Particle Container -->
            <div id="particle-container"></div>
        </div>
    </div>

    <!-- Banner Ad Container -->
    <div id="banner-ad-container" style="text-align: center; margin: 20px auto; max-width: 728px;">
        <div id="banner-ad"></div>
    </div>

    <!-- Game Script -->
    <script src="game.js"></script>

    <!-- Bottom Banner Ad -->
    <div id="bottom-ad"></div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const container = document.getElementById("bottom-ad");

            function loadBanner() {
                if (typeof shouldLoadAds === "function" && !shouldLoadAds()) {
                    console.log("üöß [ADS] Banner skipped");
                    return;
                }

                if (!container) {
                    console.log("‚ùå bottom-ad container missing");
                    return;
                }

                container.innerHTML = '<div id="banner-slot"></div>';
                const slot = document.getElementById("banner-slot");

                window.atOptions = {
                    key: "de617c07128b585ef939154460e6858f",
                    format: "iframe",
                    height: 50,
                    width: 320,
                    params: {}
                };

                const s = document.createElement("script");
                s.src = "https://www.highperformanceformat.com/de617c07128b585ef939154460e6858f/invoke.js";
                slot.appendChild(s);

                console.log("‚úÖ Banner loaded");
            }

            if (window.DEV_MODE) {
                return;
            }
            setTimeout(loadBanner, 2000);
        });
    </script>

    <!-- SEO: About Game & How to Play Section -->
    <section id="game-info" style="background: #f8f9fa; padding: 40px 20px; margin-top: 40px; text-align: center;">
        <div style="max-width: 900px; margin: 0 auto;">
            <h2 style="font-size: 2rem; color: #333; margin-bottom: 20px;">üçî About Burger Stack 3D</h2>
            <p style="font-size: 1.1rem; color: #555; line-height: 1.6; margin-bottom: 30px;">
                Burger Stack 3D is an exciting stacking puzzle game where you carefully place burger ingredients to
                build the perfect tower.
                Balance, strategy, and precision are key as you stack burgers higher and higher. Challenge yourself to
                reach new heights and
                unlock delicious rewards in this fun and engaging 3D gameplay experience.
            </p>

            <h3 style="font-size: 1.5rem; color: #333; margin-bottom: 15px;">üéÆ How to Play</h3>
            <ul
                style="font-size: 1rem; color: #555; text-align: left; display: inline-block; line-height: 2; margin-bottom: 60px;">
                <li>‚úÖ Tap and drag to position burger ingredients</li>
                <li>‚úÖ Stack ingredients carefully to keep the tower balanced</li>
                <li>‚úÖ Complete each level by stacking all ingredients</li>
                <li>‚úÖ Avoid dropping items or the tower topples</li>
                <li>‚úÖ Progress through increasingly challenging burger recipes</li>
            </ul>
        </div>
    </section>

    <script>
        window.addEventListener('load', function () {
            var loader = document.getElementById('pmg-loader');
            if (loader) {
                var fill = loader.querySelector('.pmg-bar-fill');
                if (fill) fill.style.width = '100%';
                setTimeout(function () { loader.classList.add('hidden'); }, 300);
            }
        });
    </script>
</body>

</html>