<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Early Tracking Script -->
    <script>
        (function () {
            const startTime = Date.now();
            const anonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJqcGdvdmZ6b25sbWpycnVhc3BwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAyNjA0MDQsImV4cCI6MjA4NTgzNjQwNH0.fwBaiOgXtnQVgq0IOdPmOskQHDqgOWWqr0mm3PSu57I";
            const endpoint = "https://bjpgovfzonlmjrruaspp.supabase.co/functions/v1/collect";

            const urlParams = new URLSearchParams(window.location.search);
            const placementId = urlParams.get('utm_content') || urlParams.get('placementid');

            const hitData = {
                timestamp: new Date(Date.now() + 19800000).toISOString().replace('Z', '+05:30'),
                url: location.href,
                referrer: document.referrer,
                userAgent: navigator.userAgent,
                screen: { width: screen.width, height: screen.height },
                loadStage: "pre-init",
                placement_id: placementId
            };

            const sendHit = (stage) => {
                hitData.loadStage = stage;
                hitData.timestamp = new Date(Date.now() + 19800000).toISOString().replace('Z', '+05:30');

                if (stage === "early-exit") {
                    hitData.duration_seconds = Math.round((Date.now() - startTime) / 1000);
                }

                fetch(endpoint, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "apikey": anonKey,
                        "Authorization": "Bearer " + anonKey
                    },
                    body: JSON.stringify(hitData),
                    keepalive: true
                });
            };

            sendHit("pre-init");

            window.addEventListener("pagehide", function () {
                if (!window.FIREBASE_INITIALIZED) {
                    sendHit("early-exit");
                }
            });
        })();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ludo Master - Classic Board Game | PlayMixGames</title>
    <meta name="description"
        content="Play Ludo Master online. Challenge friends or AI in this classic board game of strategy and luck!">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="../loader.css">

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6129521314653726"
        crossorigin="anonymous"></script>

    <script type="module" src="../analytics.js"></script>
    <script src="../ads.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            loadSocialBarAd();
            renderTopRightScroller();
        });
    </script>

</head>

<body>
    <!-- ===== PlayMixGames Universal Loader ===== -->
    <div id="pmg-loader">
        <div class="pmg-brand">PlayMixGames</div>
        <div class="pmg-spinner"></div>
        <div class="pmg-bar-track">
            <div class="pmg-bar-fill"></div>
        </div>
        <p class="pmg-tip">Loading...</p>
    </div>
    <!-- ========================================= -->

    <!-- Header -->
    <header>
        <a href="../index.html" class="back-btn">‚Üê PlayMixGames</a>
        <h1 class="game-title">LUDO MASTER</h1>
        <div id="turn-display" style="font-weight: 900; font-size: 0.9rem;">TURN: RED</div>
    </header>

    <!-- RIGHT SIDE ADSTERRA BANNER (Desktop Only) -->
    <div id="adsterra-banner"></div>

    <!-- Game Container -->
    <div id="game-container">
        <!-- Game regions populated by JS -->
        <div id="ludo-board">
            <!-- Dice -->
        </div>

        <div id="controls-area">
            <div id="dice-btn" class="dice-container">üé≤</div>
            <div id="message-area">Roll Dice</div>
        </div>

        <!-- UI Overlays -->
        <div id="start-screen" class="overlay-screen">
            <div class="screen-content">
                <h1 style="color: #e91e63; font-size: 2.2rem; margin-bottom: 10px;">LUDO MASTER</h1>
                <p style="color: #ccc; margin-bottom: 25px;">Choose Mode</p>

                <button id="mode-2p" class="game-btn" style="background: var(--ludo-red); color: white;">Play with AI -
                    2 Players</button>
                <button id="mode-4p" class="game-btn" style="background: var(--ludo-blue); color: white;">Play with AI -
                    4
                    Players</button>
            </div>
        </div>

        <!-- Winner Screen -->
        <div id="level-complete-screen" class="overlay-screen hidden">
            <div class="screen-content">
                <h1 id="winner-text" style="color: #ffc107; font-size: 2.5rem; margin-bottom: 10px;">BLUE WINS!</h1>
                <div style="font-size: 5rem; margin-bottom: 20px;">üëë</div>
                <button id="restart-btn" class="game-btn"
                    style="background: linear-gradient(135deg, #e91e63, #f06292); color: white;">
                    New Match
                </button>
            </div>
        </div>
    </div>

    <!-- Bottom Banner Ad -->
    <div id="bottom-ad"></div>

    <script>
        (function () {
            const container = document.getElementById("bottom-ad");
            function loadBanner() {
                if (typeof shouldLoadAds === "function" && !shouldLoadAds()) return;
                if (!container) return;
                container.innerHTML = '<div id="banner-slot"></div>';
                const slot = document.getElementById("banner-slot");
                window.atOptions = {
                    key: "de617c07128b585ef939154460e6858f",
                    format: "iframe",
                    height: 50,
                    width: 320,
                    params: {}
                };
                const s = document.createElement("script");
                s.src = "https://www.highperformanceformat.com/de617c07128b585ef939154460e6858f/invoke.js";
                slot.appendChild(s);
            }
            if (window.DEV_MODE) { return; }
            setTimeout(loadBanner, 2000);
        })();
    </script>

    <!-- SEO: About Game & How to Play Section -->
    <section id="game-info" style="background: #f8f9fa; padding: 40px 20px; margin-top: 40px; text-align: center;">
        <div style="max-width: 900px; margin: 0 auto;">
            <h2 style="font-size: 2rem; color: #333; margin-bottom: 20px;">üé≤ About Ludo Master</h2>
            <p style="font-size: 1.1rem; color: #555; line-height: 2; margin-bottom: 30px;">
                Ludo Master is a digital version of the classic Strategy board game played for centuries. Move your four
                tokens from start to finish according to the rolls of a single die.
            </p>
        </div>
    </section>

    <script src="game.js"></script>
    <script>
        window.addEventListener('load', function () {
            var loader = document.getElementById('pmg-loader');
            if (loader) {
                var fill = loader.querySelector('.pmg-bar-fill');
                if (fill) fill.style.width = '100%';
                setTimeout(function () { loader.classList.add('hidden'); }, 300);
            }
        });
    </script>
</body>

</html>